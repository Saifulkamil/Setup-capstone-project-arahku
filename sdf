sudo apt update

sudo apt install git -y

sudo apt install nano -y
sudo apt install python3-pip -y
sudo apt install python3-venv -y

sudo apt install libmysqlclient-dev -y
sudo git clone https://github.com/zulfahmidev/capstone_api.git /home/c065dsx0772/capstone_api && cd /home/c065dsx0772/capstone_api
sudo gsutil cp gs://private-capstone/dev/credentials.json /home/cloudbuild/capstone_api
sudo gsutil cp gs://private-capstone/dev/.env /home/cloudbuild/capstone_api
sudo python3 -m venv venv
. venv/bin/activate
sudo pip3 install -r requirements.txt




echo "Mengunduh credentials.json dari Google Cloud Storage..........................."
sudo gsutil cp gs://private-capstone/dev/credentials.json /home/c065dsx0772/capstone_api

echo "Mengunduh .env dari Google Cloud Storage............................."
sudo gsutil cp gs://private-capstone/prod/.env /home/c065dsx0772/capstone_api


docker run -d -p 5000:5000 gcr.io/capstone-project-arahku/staging/capstone_api:3db0423

docker run -d --name flask -p 5000:5000 gcr.io/capstone-project-arahku/staging/capstone_api:3db0423 


$ docker tag staging_flask:1.2 sepol123/staging_flask:1.2

sepol@DESKTOP-AJS8GJJ MINGW64 /e/GIT/staging/capstone_api (staging)
$ docker push sepol123/staging_flask:1.2


gcloud run deploy capstone-api-staging \
--image=asia-southeast2-docker.pkg.dev/capstone-project-arahku/staging/capstone_api@sha256:941358794cb68afc5853b994806c6886771bf28bbc7ed1cb0036b2b1d8893ce2 \
--no-allow-unauthenticated \
--port=5000 \
--service-account=864735063861-compute@developer.gserviceaccount.com \
--memory=128Mi \
--min-instances=1 \
--max-instances=3 \
--set-cloudsql-instances=capstone-project-arahku:asia-southeast2:staging \
--region=asia-southeast2 \
--project=capstone-project-arahku